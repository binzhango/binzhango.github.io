<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Bin Zhang"><link href=http://binzhango.github.io/2020/11/azure-data-factory-data-flow/ rel=canonical><link href=../../03/spark-dataframe-window-function/ rel=prev><link href=../../../2021/07/setup-minikube/ rel=next><link rel=icon href=../../../assets/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.41"><title>Azure Data Factory (Data Flow) - B~~~~~Z</title><link rel=stylesheet href=../../../assets/stylesheets/main.0253249f.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-HLMVZHNEWM"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-HLMVZHNEWM",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-HLMVZHNEWM",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta property=og:type content=website><meta property=og:title content="Azure Data Factory (Data Flow) - B~~~~~Z"><meta property=og:description content=None><meta property=og:image content=http://binzhango.github.io/assets/images/social/posts/Azure-Data-Factory-Data-Flow.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=http://binzhango.github.io/2020/11/azure-data-factory-data-flow/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Azure Data Factory (Data Flow) - B~~~~~Z"><meta name=twitter:description content=None><meta name=twitter:image content=http://binzhango.github.io/assets/images/social/posts/Azure-Data-Factory-Data-Flow.png> <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=amber data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#task1 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=B~~~~~Z class="md-header__button md-logo" aria-label=B~~~~~Z data-md-component=logo> <img src=../../../assets/favicon.ico alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> B~~~~~Z </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Azure Data Factory (Data Flow) </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=amber data-md-color-accent=indigo aria-label="Dark Mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Dark Mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=indigo aria-label="Light Mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Light Mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/binzhango/binzhango.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> binzhango/binzhango.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class="md-tabs__item md-tabs__item--active"> <a href=../../.. class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a href=../../../2024/ class=md-tabs__link> Archive </a> </li> <li class=md-tabs__item> <a href=../../../category/azure/ class=md-tabs__link> Categories </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=B~~~~~Z class="md-nav__button md-logo" aria-label=B~~~~~Z data-md-component=logo> <img src=../../../assets/favicon.ico alt=logo> </a> B~~~~~Z </label> <div class=md-nav__source> <a href=https://github.com/binzhango/binzhango.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> binzhango/binzhango.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> <li class=md-nav__item> <a href=../../../2021/ class=md-nav__link> <span class=md-ellipsis> 2021 </span> </a> </li> <li class=md-nav__item> <a href=../../ class=md-nav__link> <span class=md-ellipsis> 2020 </span> </a> </li> <li class=md-nav__item> <a href=../../../2012/ class=md-nav__link> <span class=md-ellipsis> 2012 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../category/azure/ class=md-nav__link> <span class=md-ellipsis> Azure </span> </a> </li> <li class=md-nav__item> <a href=../../../category/llm/ class=md-nav__link> <span class=md-ellipsis> LLM </span> </a> </li> <li class=md-nav__item> <a href=../../../category/ml/ class=md-nav__link> <span class=md-ellipsis> ML </span> </a> </li> <li class=md-nav__item> <a href=../../../category/snowflake/ class=md-nav__link> <span class=md-ellipsis> Snowflake </span> </a> </li> <li class=md-nav__item> <a href=../../../category/spark/ class=md-nav__link> <span class=md-ellipsis> Spark </span> </a> </li> <li class=md-nav__item> <a href=../../../category/airflow/ class=md-nav__link> <span class=md-ellipsis> airflow </span> </a> </li> <li class=md-nav__item> <a href=../../../category/k8s/ class=md-nav__link> <span class=md-ellipsis> k8s </span> </a> </li> <li class=md-nav__item> <a href=../../../category/python/ class=md-nav__link> <span class=md-ellipsis> python </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content md-content--post" data-md-component=content> <div class="md-sidebar md-sidebar--post" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class="md-sidebar__inner md-post"> <nav class="md-nav md-nav--primary"> <div class=md-post__back> <div class="md-nav__title md-nav__container"> <a href=../../.. class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> <span class=md-ellipsis> Back to index </span> </a> </div> </div> <ul class="md-post__meta md-nav__list"> <li class="md-nav__item md-nav__item--section"> <div class=md-post__title> <span class=md-ellipsis> Metadata </span> </div> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg> <time datetime="2020-11-18 21:27:29" class=md-ellipsis>November 18, 2020</time> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg> <span class=md-ellipsis> in <a href=../../../category/azure/ >Azure</a></span> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg> <span class=md-ellipsis> 4 min read </span> </div> </li> </ul> </nav> </li> </ul> </nav> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#adf-pipeline class=md-nav__link> <span class=md-ellipsis> ADF Pipeline </span> </a> </li> <li class=md-nav__item> <a href=#activities class=md-nav__link> <span class=md-ellipsis> Activities </span> </a> <nav class=md-nav aria-label=Activities> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-metadata class=md-nav__link> <span class=md-ellipsis> Get Metadata </span> </a> </li> <li class=md-nav__item> <a href=#foreach class=md-nav__link> <span class=md-ellipsis> ForEach </span> </a> </li> <li class=md-nav__item> <a href=#set-variables class=md-nav__link> <span class=md-ellipsis> Set Variables </span> </a> </li> <li class=md-nav__item> <a href=#dataflow class=md-nav__link> <span class=md-ellipsis> Dataflow </span> </a> <nav class=md-nav aria-label=Dataflow> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aggregation-of-filenames class=md-nav__link> <span class=md-ellipsis> Aggregation of filenames </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <article class="md-content__inner md-typeset"> <nav class=md-tags> <span class=md-tag>Data Engineer</span> </nav> <div><p>Recently I'm working in Azure to implement ETL jobs. The main tool is ADF (Azure Data Factory). This post show some solutions to resolve issue in my work.</p> <!-- more --> <h1 id=task1>Task1<a class=headerlink href=#task1 title="Permanent link">#</a></h1> <p>Process CSV files and merge different system files into one file</p> <ul> <li>Source: CSV files with filename format (<em>abcd_yyyymmdd_uuid.csv</em>), where abcd is system id.<ul> <li>a_20180101_9ca2bed1-2ed0-eaeb-8401-784f43755025.csv</li> <li>a_20180101_cca2bed1-aed0-11eb-8401-784f73755025.csv</li> <li>b_20190202_ece2bed1-2ed0-abeb-8401-784f43755025.csv</li> <li>c_20180101_ada2bed1-2ed0-22eb-8401-784f43755025.csv</li> </ul> </li> <li>Sink: yyyymmdd.csv<ul> <li>20180101.csv</li> <li>20190202.csv</li> </ul> </li> </ul> <h2 id=adf-pipeline>ADF Pipeline<a class=headerlink href=#adf-pipeline title="Permanent link">#</a></h2> <p><a class=glightbox href=../../../assets/images/adf_pipeline.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=Pipeline src=../../../assets/images/adf_pipeline.png title=Pipeline></a> <a class=glightbox href=../../../assets/images/parameter.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/parameter.png title=parameters></a> <a class=glightbox href=../../../assets/images/variables.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/variables.png title=variables></a></p> <h2 id=activities>Activities<a class=headerlink href=#activities title="Permanent link">#</a></h2> <h3 id=get-metadata>Get Metadata<a class=headerlink href=#get-metadata title="Permanent link">#</a></h3> <ul> <li>Input: source directory/parameters</li> <li>Output: metadata of each object</li> </ul> <p>Get Metadata activity iterate source directory to obtain each object. The most important one is <strong>Argument</strong> <a class=glightbox href=../../../assets/images/getmetadata.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt="Get Metadata" src=../../../assets/images/getmetadata.png title="Get Metadata"></a></p> <h3 id=foreach>ForEach<a class=headerlink href=#foreach title="Permanent link">#</a></h3> <ul> <li>Input: output of <em>Get Metadata</em></li> <li>Output: None</li> </ul> <p>ForEach activity is used to process each object in source direcoty.</p> <p></p><div class="language-sh highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>@activity<span class=o>(</span><span class=s1>'Get Metadata1'</span><span class=o>)</span>.output.childItems
</span></code></pre></div> <a class=glightbox href=../../../assets/images/foreach.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/foreach.png title=ForEach></a> <h3 id=set-variables>Set Variables<a class=headerlink href=#set-variables title="Permanent link">#</a></h3> <p>It's convenient to predefine a value used in next step.</p> <p><a class=glightbox href=../../../assets/images/variable_activity.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/variable_activity.png title="Set Variable"></a></p> <h3 id=dataflow>Dataflow<a class=headerlink href=#dataflow title="Permanent link">#</a></h3> <p><a class=glightbox href=../../../assets/images/dataflow.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/dataflow.png title=Dataflow></a></p> <p>The dataflow merge all files with same date, and source1 and sink are the same destination. So, initially source1 is empty and check this options. <a class=glightbox href=../../../assets/images/source1.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/source1.png title=source1></a></p> <p>The only configuration in Sink is the <span style="color: rgb(0, 200,200)"> <em>File name option</em> </span> <a class=glightbox href=../../../assets/images/sink.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/sink.png title=sink></a></p> <h4 id=aggregation-of-filenames>Aggregation of filenames<a class=headerlink href=#aggregation-of-filenames title="Permanent link">#</a></h4> <p>The last problem in dataflow is how to merge files with same date in dataflow, which means we firstly find out all these files. The solution to this problems is regex expression.</p> <p><a class=glightbox href=../../../assets/images/source2.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/source2.png title=source2></a></p> <h1 id=task2>Task2<a class=headerlink href=#task2 title="Permanent link">#</a></h1> <p>Generally CSV file has a header and we can process it easily in ADF. However, a special case is a large CSV file has multiple different headers and we need to automatically split it into regular csv files with headers respectively.</p> <ul> <li> <p>Sample data: &gt; h1,h1_col1,h1_col2,h1_col3 &gt; h2,h2_col1,h2_col2,h2_col3,h2_col4,h2_col5 &gt; h3,h3_col1,h3_col2 &gt; h1,h1_row1_1,h1_row1_2,h1_row1_3 &gt; h1,h1_row2_1,h1_row2_2,h1_row2_3 &gt; h1,h1_row3_1,h1_row3_2,h1_row3_3 &gt; h2,h2_row1_1,h2_row1_2,h2_row1_3,h2_row1_4,h2_row1_5 &gt; h2,h2_row2_1,h2_row2_2,h2_row2_3,h2_row2_4,h2_row2_5 &gt; h2,h2_row3_1,h2_row3_2,h2_row3_3,h2_row3_4,h2_row3_5 &gt; h2,h2_row4_1,h2_row4_2,h2_row4_3,h2_row4_4,h2_row4_5 &gt; h2,h2_row5_1,h2_row5_2,h2_row5_3,h2_row5_4,h2_row5_5 &gt; h3,h3_row1_1,h3_row1_2 &gt; h3,h3_row2_1,h3_row2_2</p> </li> <li> <p>Explanation:</p> <ul> <li>header format: <em>header name</em>, <em>columns names</em></li> <li>3 headers : h1, h2 and h3</li> <li>the 1<sup>st</sup> column of each row is header name and rest of columns are values</li> </ul> </li> <li> <p>Output:</p> <ul> <li>h1 file &gt; h1_col1,h1_col2,h1_col3 &gt; h1_row1_1,h1_row1_2,h1_row1_3 &gt; h1_row2_1,h1_row2_2,h1_row2_3 &gt; h1_row3_1,h1_row3_2,h1_row3_3</li> <li>h2 file &gt; h2_col1,h2_col2,h2_col3,h2_col4,h2_col5 &gt; h2_row1_1,h2_row1_2,h2_row1_3,h2_row1_4,h2_row1_5 &gt; h2_row2_1,h2_row2_2,h2_row2_3,h2_row2_4,h2_row2_5 &gt; h2_row3_1,h2_row3_2,h2_row3_3,h2_row3_4,h2_row3_5 &gt; h2_row4_1,h2_row4_2,h2_row4_3,h2_row4_4,h2_row4_5 &gt; h2_row5_1,h2_row5_2,h2_row5_3,h2_row5_4,h2_row5_5</li> <li>h3 file &gt; h3_col1,h3_col2 &gt; h3_row1_1,h3_row1_2 &gt; h3_row2_1,h3_row2_2</li> </ul> </li> </ul> <h2 id=dataflow_1>Dataflow<a class=headerlink href=#dataflow_1 title="Permanent link">#</a></h2> <p><a class=glightbox href=../../../assets/images/dataflow1.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/dataflow1.png title=dataflow1></a></p> <p>The dataset used in <em>source</em> and <em>sink</em> must uncheck this </p> <p><a class=glightbox href=../../../assets/images/dataset1.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/dataset1.png title=dataset></a></p> <h3 id=derivedcolumn>DerivedColumn<a class=headerlink href=#derivedcolumn title="Permanent link">#</a></h3> <p>Because no header is in the dataset, ADF automatically assign a column name to each one. The column name format is <strong>_col<span style="color: rgb(0, 200,200)">index</span>_</strong></p> <p>In this task the header column is <span style="color: rgb(0, 200,200)">_col0_</span> and we can map this one to another name like <strong>filename</strong> <a class=glightbox href=../../../assets/images/derived_col.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/derived_col.png title=col></a></p> <h3 id=sink>Sink<a class=headerlink href=#sink title="Permanent link">#</a></h3> <p><a class=glightbox href=../../../assets/images/sink1.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt src=../../../assets/images/sink1.png title=sink1></a></p> <p>This dataflow will automatically split composite CSV file into different files and save them at container root path. To save them at another directory, you can add folder name to the mapping column name in DerivedColumn activity.</p> <h2 id=trigger>Trigger<a class=headerlink href=#trigger title="Permanent link">#</a></h2> <p>We use blob event trigger to implement automation. Once uploading a new file is done, these pipeline will process it automatically. <a href=https://docs.microsoft.com/en-us/azure/data-factory/how-to-create-event-trigger>How to create event trigger</a></p> <p>Two values in trigger are used by pipeline - <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/triggerBody title="GitHub User: triggerBody">@triggerBody</a>().folderPath : /container name/folder/ - <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/triggerBody title="GitHub User: triggerBody">@triggerBody</a>().fileName : blob name</p> <h3 id=pandas-processing>Pandas Processing<a class=headerlink href=#pandas-processing title="Permanent link">#</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kn>import</span> <span class=nn>csv</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>'sample.csv'</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>'^([^,]+),'</span><span class=p>,</span><span class=n>engine</span><span class=o>=</span><span class=s1>'python'</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=n>df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=n>heads</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span><span class=o>.</span><span class=n>unique</span><span class=p>()</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=n>d</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=mi>0</span><span class=p>])))</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=k>for</span> <span class=n>h</span> <span class=ow>in</span> <span class=n>heads</span><span class=p>:</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>    <span class=n>outputfile</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=n>h</span><span class=p>]</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>    <span class=n>outputfile</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>outputfile</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>    <span class=n>outputfile</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=s1>'</span><span class=si>{0}</span><span class=s1>.csv'</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>h</span><span class=p>),</span> <span class=n>sep</span><span class=o>=</span><span class=s1>' '</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>header</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></code></pre></div></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../03/spark-dataframe-window-function/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Spark Dataframe window function"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Spark Dataframe window function </div> </div> </a> <a href=../../../2021/07/setup-minikube/ class="md-footer__link md-footer__link--next" aria-label="Next: Setup Minikube"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Setup Minikube </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href=https://github.com/binzhango target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=mailto:zhangbinengr@hotmail.com target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg> </a> <a href=None target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["header.autohide", "navigation.footer", "navigation.indexes", "navigation.top", "navigation.path", "navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.tracking", "content.code.copy", "content.tabs.link", "content.code.annotate", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.83f73b43.min.js></script> <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>