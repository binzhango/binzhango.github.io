<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Azure Data Factory (Data Flow) · Bin's Blog</title><meta name="description" content="Azure Data Factory (Data Flow) - Bin Zhang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="../../../../favicon.ico"><link rel="stylesheet" href="../../../../css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/binzhango/binzhango.github.io/atom.xml" title="Bin's Blog"><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="atom.xml" title="Bin's Blog" type="application/atom+xml">
<!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">Bin's Blog</h2></a></div><a href="../../../../index.html" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="../../../../archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><ul class="shortcut-icons"><a href="https://github.com/AngryPowman" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">Azure Data Factory (Data Flow)</h1><div class="post-info">Nov 18, 2020</div><div class="post-content"><p>Recently I’m working in Azure to implement ETL jobs. The main tool is ADF (Azure Data Factory). This post show some solutions to resolve issue in my work.</p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><h2 id="task"><a class="markdownIt-Anchor" href="#task"></a> Task</h2>
<p>Process CSV files and merge different system files into one file</p>
<ul>
<li>Source: CSV files with filename format (<em>abcd_yyyymmdd_uuid.csv</em>), where abcd is system id.
<ul>
<li>a_20180101_9ca2bed1-2ed0-eaeb-8401-784f43755025.csv</li>
<li>a_20180101_cca2bed1-aed0-11eb-8401-784f73755025.csv</li>
<li>b_20190202_ece2bed1-2ed0-abeb-8401-784f43755025.csv</li>
<li>c_20180101_ada2bed1-2ed0-22eb-8401-784f43755025.csv</li>
</ul>
</li>
<li>Sink: yyyymmdd.csv
<ul>
<li>20180101.csv</li>
<li>20190202.csv</li>
</ul>
</li>
</ul>
<h2 id="adf-pipeline"><a class="markdownIt-Anchor" href="#adf-pipeline"></a> ADF Pipeline</h2>
<p><img src="/images/adf_pipeline.png" alt="Pipeline" title="Pipeline" /><br />
<img src="/images/parameter.png" alt="" title="parameters" /><br />
<img src="/images/variables.png" alt="" title="variables" /></p>
<h2 id="activities"><a class="markdownIt-Anchor" href="#activities"></a> Activities</h2>
<h4 id="get-metadata"><a class="markdownIt-Anchor" href="#get-metadata"></a> Get Metadata</h4>
<ul>
<li>Input: source directory/parameters</li>
<li>Output: metadata of each object</li>
</ul>
<p>Get Metadata activity iterate source directory to obtain each object. The most important one is <strong>Argument</strong><br />
<img src="/images/getmetadata.png" alt="Get Metadata" title="Get Metadata" /></p>
<h4 id="foreach"><a class="markdownIt-Anchor" href="#foreach"></a> ForEach</h4>
<ul>
<li>Input: output of <em>Get Metadata</em></li>
<li>Output: None</li>
</ul>
<p>ForEach activity is used to process each object in source direcoty.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">@activity(<span class="hljs-string">&#x27;Get Metadata1&#x27;</span>).output.childItems<br></code></pre></td></tr></table></figure>
<p><img src="/images/foreach.png" alt="" title="ForEach" /></p>
<h4 id="set-variables"><a class="markdownIt-Anchor" href="#set-variables"></a> Set Variables</h4>
<p>It’s convenient to predefine a value used in next step.</p>
<p><img src="/images/variable_activity.png" alt="" title="Set Variable" /></p>
<h4 id="dataflow"><a class="markdownIt-Anchor" href="#dataflow"></a> Dataflow</h4>
<p><img src="/images/dataflow.png" alt="" title="Dataflow" /></p>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'angrypowman';
var disqus_identifier = '2020/11/18/Azure-Data-Factory-Data-Flow/';
var disqus_title = 'Azure Data Factory (Data Flow)';
var disqus_url = 'https://github.com/binzhango/binzhango.github.io/2020/11/18/Azure-Data-Factory-Data-Flow/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//angrypowman.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="../../../03/01/Spark-Dataframe-window-function/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2020 <a href="https://github.com/binzhango/binzhango.github.io">Bin Zhang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"angrypowman",'auto');ga('send','pageview');</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>