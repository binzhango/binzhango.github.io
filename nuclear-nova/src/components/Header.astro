---
import type { Props } from '@astrojs/starlight/props';
import Search from '@astrojs/starlight/components/Search.astro';
import SocialIcons from '@astrojs/starlight/components/SocialIcons.astro';
import ThemeToggle from './ThemeToggle.astro';
import LanguageSelect from '@astrojs/starlight/components/LanguageSelect.astro';
import SidebarToggle from './SidebarToggle.astro';

// Hide toggle on pages without sidebar (splash template pages)
const isHomePage = Astro.url.pathname === '/' || Astro.url.pathname === '';
const isArchivePage = Astro.url.pathname.includes('/archive');
const isTagsPage = Astro.url.pathname.startsWith('/tags/');
const isCategoriesPage = Astro.url.pathname.startsWith('/categories/');
const hideToggle = isHomePage || isArchivePage || isTagsPage || isCategoriesPage;
---

{!hideToggle && <SidebarToggle />}

<div class="header-wrapper">
	<div class="header sl-flex">
		<!-- Logo and Name on the left -->
		<a href="/" class="site-logo sl-flex">
			<img src="/assets/favicon.ico" alt="B~~~~~Z" class="logo-icon" />
			<span class="site-name">B~~~~~Z</span>
		</a>
		
		<!-- Navigation and controls on the right -->
		<div class="header-right sl-flex">
			<!-- Navigation Links -->
			<nav class="header-nav sl-flex">
				<a href="/" class="nav-link">home</a>
				<a href="/posts/2025/03-29-llm-usage" class="nav-link">blog</a>
				<a href="/archive/" class="nav-link">archive</a>
				<a href="https://github.com/binzhango" target="_blank" rel="noopener noreferrer" class="nav-link">about</a>
			</nav>

			<!-- Search and Controls -->
			<div class="header-controls sl-flex">
				<div class="search-wrapper">
					<Search {...Astro.props} />
				</div>
				
				{Astro.props.hasSidebar && (
					<starlight-menu-button>
						<button
							aria-expanded="false"
							aria-label="Menu"
							aria-controls="starlight__sidebar"
							class="sl-flex md:sl-hidden"
						>
							<svg
								aria-hidden="true"
								width="16"
								height="16"
								viewBox="0 0 24 24"
								fill="currentColor"
							>
								<path d="M3 8h18M3 16h18" />
							</svg>
						</button>
					</starlight-menu-button>
				)}
				<ThemeToggle />
				{Astro.props.locales && <LanguageSelect {...Astro.props} />}
				<SocialIcons {...Astro.props} />
			</div>
		</div>
	</div>
</div>

<style>
	.header-wrapper {
		width: 100%;
		display: flex;
		justify-content: center;
		padding: 0 1rem;
	}

	.header {
		width: 100%;
		max-width: 1400px;
		justify-content: space-between;
		align-items: center;
		height: 100%;
		gap: 2rem;
	}

	/* Logo and Name on the left */
	.site-logo {
		gap: 0.75rem;
		align-items: center;
		text-decoration: none;
		flex-shrink: 0;
		transition: opacity 0.2s ease;
	}

	.site-logo:hover {
		opacity: 0.8;
	}

	.logo-icon {
		width: 2rem;
		height: 2rem;
		border-radius: 0.25rem;
	}

	.site-name {
		font-size: 1.25rem;
		font-weight: 700;
		color: var(--sl-color-text-accent);
		letter-spacing: 0.05em;
	}

	/* Right side container */
	.header-right {
		gap: 2rem;
		align-items: center;
		flex: 1;
		justify-content: flex-end;
		min-width: 0;
	}

	/* Navigation Links */
	.header-nav {
		gap: 1.5rem;
		align-items: center;
		flex-shrink: 0;
	}

	.nav-link {
		font-size: 0.95rem;
		font-weight: 500;
		color: var(--sl-color-text);
		text-decoration: none;
		position: relative;
		transition: color 0.2s ease;
		white-space: nowrap;
	}

	.nav-link:hover {
		color: var(--sl-color-accent);
	}

	.nav-link::after {
		content: '';
		position: absolute;
		bottom: -4px;
		left: 0;
		width: 0;
		height: 2px;
		background: var(--sl-color-accent);
		transition: width 0.2s ease;
	}

	.nav-link:hover::after {
		width: 100%;
	}

	/* Search and Controls */
	.header-controls {
		gap: 1rem;
		align-items: center;
		flex-shrink: 0;
	}

	.search-wrapper {
		min-width: 200px;
	}

	/* Responsive Design */
	@media (max-width: 768px) {
		.header-nav {
			display: none;
		}
		
		.search-wrapper {
			min-width: 150px;
		}

		.logo-icon {
			width: 1.75rem;
			height: 1.75rem;
		}

		.site-name {
			font-size: 1.1rem;
		}

		.header-right {
			gap: 1rem;
		}
	}

	@media (max-width: 1024px) {
		.header-nav {
			gap: 1rem;
		}

		.nav-link {
			font-size: 0.875rem;
		}

		.header-right {
			gap: 1.5rem;
		}
	}
</style>
